# PocketSmith Category Recategorisation Plan

## Overview
Consolidate 63 existing PocketSmith categories down to 12 new categories, using labels to retain granular information.

## Step 1: Category Mapping

### 12 New Categories

1. **Bills**: Necessary household bills including utilities, tax services, phone/internet, online subscriptions, insurance, health, medical appointments
2. **Dining**: Discretionary eating at restaurants/cafes, work lunch, takeout from restaurants  
3. **Education**: School fees, music lessons, kids classes, child care, tutoring
4. **Giving**: Church giving, charity, mission giving
5. **Groceries**: Supermarkets, grocery stores, fresh markets, butchers
6. **Holidays**: Flights, hotels
7. **Household**: Necessary household spending (not bills) - maintenance, cleaning/lawn services, repairs, tradies (handyman, locksmith, electrician, tree/gutter cleaning), home office supplies, stationary, clothing, kitchen tools, computers, printers, pet expenses
8. **Income**: Salary, government payments, investment income
9. **Mortgage**: Mortgage interest payments
10. **Shopping**: Non-necessary lifestyle spending - toys, makeup, high-end clothing, bikes/cycling clothes, running clothes/shoes, games, music, high-end bags, fashion, jewellery, hobbies
11. **Transfer**: Fund transfers between accounts (usually same amounts with opposite signs, same day or within 1-2 days)
12. **Transport**: All transport expenses - parking, petrol, public transport, parking/traffic fines

### Mapping from 63 Existing Categories

| Old Category | New Category | Rationale |
|--------------|--------------|-----------|
| Bills | Bills | Direct match - household bills |
| Eating out | Dining | Restaurant/cafe spending |
| Education | Education | Direct match |
| Giving | Giving | Direct match |
| Groceries | Groceries | Direct match |
| Household | Household | General household spending |
| Income | Income | Direct match |
| Insurance | Bills | Necessary household bill |
| Medical | Bills | Health/medical appointments |
| Mortgage | Mortgage | Direct match |
| Online Services | Bills | Online subscriptions |
| Recreation | Shopping | Discretionary lifestyle spending |
| Service Charges/Fees | Bills | Bank/service fees |
| Transfer | Transfer | Direct match |
| Transport | Transport | Direct match |
| Clothing/Shoes | Household | Basic clothing needs |
| Refunds/Adjustments | Transfer | Account adjustments |
| Healthcare/Medical | Bills | Health services |
| Home Maintenance | Household | House maintenance |
| Transfers | Transfer | Fund transfers |
| Shopping | Shopping | Direct match - discretionary |
| Provider Fee | Bills | Service provider fees |
| Bank Fees | Bills | Banking charges |
| Fuel | Transport | Petrol/fuel |
| Alcohol & Bars | Dining | Restaurant/bar spending |
| Professional Services | Bills | Tax/professional services |
| Government Services | Bills | Government fees |
| Automotive | Transport | Car-related expenses |
| Computing | Household | Home computers/tech |
| Housing | Mortgage | Housing-related costs |
| Cash Withdrawal | Household | Cash transfers |
| Postage | Household | Home office supplies |
| Jewellery | Shopping | Luxury/fashion items |
| Child Care | Education | Child care services |
| Business Miscellaneous | Bills | Business-related bills |
| Printing | Household | Home office supplies |
| Restaurants/Dining | Dining | Restaurant spending |
| Travel | Holidays | Travel expenses |
| Electronics | Household | Home electronics |
| Healthcare / Medical | Bills | Health services |
| Gasoline/Fuel | Transport | Vehicle fuel |
| Rentals | Mortgage | Rental services |
| Phone | Bills | Phone services |
| Charitable Giving | Giving | Charity donations |
| Office Supplies | Household | Home office supplies |
| Utilities | Bills | Utility bills |
| Personal Care | Shopping | Personal care items |
| Automotive Expenses | Transport | Car expenses |
| Clothing | Household | Basic clothing |
| Rent | Mortgage | Rental payments |
| Child/Dependent Expenses | Education | Child-related costs |
| Taxes | Income | Tax payments |
| Home Improvement | Household | Home maintenance |
| Telephone Services | Bills | Phone/internet bills |
| Dues and Subscriptions | Bills | Subscription services |
| Pets/Pet Care | Household | Pet expenses |
| Cable/Satellite Services | Bills | Internet/TV services |
| Securities Trades | Income | Investment transfers |
| Retirement Contributions | Income | Retirement transfers |
| Hobbies | Shopping | Hobby spending |
| Postage and Shipping | Household | Shipping/postage |
| Power | Bills | Utility bills |
| Loan Repayment | Mortgage | Loan payments |

## Step 2: Label Strategy

### Label Guidelines
- Short and succinct (single words preferred)
- Maximum 2 words connected by hyphen if needed
- No other punctuation permitted
- Consolidate similar meanings
- Retain information lost in category consolidation
- Avoid one-to-one mapping with old categories

### Proposed Labels

**Labels for any category:**
- `refund` (Refunds/Adjustments)

**Bills-related labels:**
- `utilities` (Power, Utilities, Water, Council rates)
- `internet` (Phone, Telephone Services, Cable/Satellite Services)
- `insurance` (Home Insurance)
- `medical` (Medical, Healthcare/Medical, Health Insurance)
- `subscriptions` (Online Services, Dues and Subscriptions, Apps)

**Dining labels:**
- `lunch` (Work lunch)
- `takeout` (Takeout for family)
- `restaurants` (Cafes, Dining, Restaurants, Bars)

**Education labels:**
- `classes` (School Fees, Events, Uniforms, Tutoring, Music Lessons)
- `camps` (School Camps, Youth Camps, Excursions)
- `childcare` (Child Care, Child/Dependent Expenses)

**Giving labels:**
- `church` (Church Giving)
- `missions` (Missions Giving, Mission Expenses)
- `charity` (Charitable Giving)

**Groceries labels:**
- `markets` (Fresh Markets, Butchers, Farmers Markets)
- `supermarkets` (Supermarkets)

**Holiday labels:**
- `flights` (Flights, Airplanes, Trains)
- `hotels` (Hotels, Airbnbs)
- `tours` (Tourism Expenses)

**Household labels:**
- `personal-care` (Clothing, Clothing/Shoes, Personal Care, Hairdressing)
- `maintenance` (Home Maintenance, Home Improvement, Cleaning, Lawn, Repairs, Tradies)
- `production` (Office Supplies, Printing, Postage, Computing, Electronics)
- `pets` (Pets/Pet Care)
- `cash` (Cash Withdrawal)

**Income labels:**
- `salary` (Salary)
- `stocks` (Stock Income, RSU, ESPP)
- `tax` (Taxes)
- `loans` (Loan Repayment, Family Loans)
- `other-income` (Government Payments, NDIS)
- `investment` (Securities Trades, Investment Gains and Losses)
- `superannuation` (Retirement Contributions, Superannuation)

**Mortgage labels:**
- `loans` (Loan Repayment)
- `rent` (Rent, Rentals)

**Shopping labels:**
- `health` (Sports)
- `fashion` (Fashion, Clothing, Clothing/Shoes, Makeup)
- `personal-care` (Personal Care, Nails, Pedicures, Manicures)
- `hobbies` (Hobbies, Games, Music, Toys)

**Transport labels:**
- `petrol` (Fuel, Gasoline/Fuel)
- `car` (Automotive, Automotive Expenses, Car Servicing, Repair)
- `insurance` (Car Insurance)
- `public-transport` (Public Transport)
- `parking` (Parking)
- `fines` (Parking Fines, Speeding Fines)
- `tolls` (Toll Roads)

### Category-to-Label Mapping

| Old Category | New Category | Suggested Labels |
|--------------|--------------|------------------|
| Bills | Bills | `utilities` |
| Eating out | Dining | `restaurants` |
| Education | Education | `classes` |
| Giving | Giving | `church` |
| Groceries | Groceries | (none - generic groceries) |
| Household | Household | (none - generic household) |
| Income | Income | `salary` |
| Insurance | Bills | `insurance` |
| Medical | Bills | `medical` |
| Mortgage | Mortgage | `loans` |
| Online Services | Bills | `subscriptions` |
| Recreation | Shopping | `hobbies` |
| Service Charges/Fees | Bills | (none - generic fees) |
| Transfer | Transfer | (none - generic transfer) |
| Transport | Transport | (none - generic transport) |
| Clothing/Shoes | Household | `personal-care` |
| Refunds/Adjustments | Transfer | `refund` |
| Healthcare/Medical | Bills | `medical` |
| Home Maintenance | Household | `maintenance` |
| Transfers | Transfer | (none - generic transfer) |
| Shopping | Shopping | (none - generic shopping) |
| Provider Fee | Bills | (none - generic provider) |
| Bank Fees | Bills | (none - bank fees) |
| Fuel | Transport | `petrol` |
| Alcohol & Bars | Dining | `restaurants` |
| Professional Services | Bills | (none) |
| Government Services | Bills | (none) |
| Automotive | Transport | `car` |
| Computing | Household | `production` |
| Housing | Mortgage | `rent` |
| Cash Withdrawal | Household | `cash` |
| Postage | Household | `production` |
| Jewellery | Shopping | `fashion` |
| Child Care | Education | `childcare` |
| Business Miscellaneous | Bills | (none - business) |
| Printing | Household | `production` |
| Restaurants/Dining | Dining | `restaurants` |
| Travel | Holidays | `flights` |
| Electronics | Household | `production` |
| Healthcare / Medical | Bills | `medical` |
| Gasoline/Fuel | Transport | `petrol` |
| Rentals | Mortgage | `rent` |
| Phone | Bills | `internet` |
| Charitable Giving | Giving | `charity` |
| Office Supplies | Household | `production` |
| Utilities | Bills | `utilities` |
| Personal Care | Shopping | `personal-care` |
| Automotive Expenses | Transport | `car` |
| Clothing | Household | `personal-care` |
| Rent | Mortgage | `rent` |
| Child/Dependent Expenses | Education | `childcare` |
| Taxes | Income | `tax` |
| Home Improvement | Household | `maintenance` |
| Telephone Services | Bills | `internet` |
| Dues and Subscriptions | Bills | `subscriptions` |
| Pets/Pet Care | Household | `pets` |
| Cable/Satellite Services | Bills | `internet` |
| Securities Trades | Income | `investment` |
| Retirement Contributions | Income | `superannuation` |
| Hobbies | Shopping | `hobbies` |
| Postage and Shipping | Household | `production` |
| Power | Bills | `utilities` |
| Loan Repayment | Mortgage | `loans` |

## Step 3: Implementation Plan

### Remapping Script Requirements
1. **Progress Tracking**: Save progress to avoid re-processing transactions
2. **Batch Processing**: Handle tens of thousands of transactions efficiently
3. **Error Recovery**: Resume from interruptions
4. **Validation**: Ensure no transactions left before category deletion

### Process Flow
For each existing category:
1. List all transactions in the category
2. For each transaction:
   - Move to new category (create if doesn't exist)
   - Apply appropriate labels
   - Mark as processed in progress file
3. Verify no transactions remain in old category
4. Delete old category
5. Update progress tracking

### API Operations Available

**✅ Available:**
- `client.transactions.list_transactions(user_id)` - Returns ALL user transactions (no category filter)
- `client.transactions.update_transaction(transaction_id, **kwargs)` - Update transaction with new category_id and labels
- `client.categories.delete_category(category_id)` - Delete category (uncategorizes all transactions)
- `client.categories.create_category(user_id, **kwargs)` - Create new categories

**❌ Not Available:**
- Direct category filtering in `list_transactions()` - must filter transactions manually

**Alternative Approach:**
Since there's no `list_transactions_by_category()`, we need to:
1. Get ALL transactions with `client.transactions.list_transactions(user_id)`
2. Filter them manually by checking `transaction.category['id']` 
3. Process each matching transaction

**Transaction Structure:**
```python
transaction.to_dict() = {
    'id': 123456,
    'category': {'id': 7312266, 'title': 'Bills', ...},
    'labels': [],  # List of current labels
    'payee': 'Merchant name',
    'amount': -100.50,
    ...
}
```

**Labels:**
- Labels don't require creation - just provide as list in `update_transaction()`
- Current labels accessible via `transaction.labels`

### Revised Process Flow
For each existing category:
1. Load ALL transactions with `client.transactions.list_transactions(user_id)`
2. Filter for transactions where `transaction.category['id'] == old_category_id`
3. For each matching transaction:
   - Update with new category_id and labels using `client.transactions.update_transaction()`
   - Mark as processed in progress file
4. Verify no transactions remain in old category (re-check all transactions)
5. Delete old category with `client.categories.delete_category()`
6. Update progress tracking

### Progress File Format
```json
{
  "processed_categories": [7312266, 7312544, ...],
  "processed_transactions": [12345, 67890, ...],
  "created_categories": {"Bills": new_id, "Dining": new_id, ...}
}
```

## Execution Steps
1. Define 12 new categories and their purposes
2. Map all 63 existing categories to new ones
3. Design label strategy for retained information
4. Implement and test remapping script
5. Execute remapping (potentially multiple runs)
6. Verify final state: exactly 12 categories remain

## Current Status
- [ ] Step 1: Define new categories and mapping
- [ ] Step 2: Design label strategy  
- [ ] Step 3: Implement remapping script
- [ ] Step 4: Execute remapping
- [ ] Step 5: Verification and cleanup